workflows:
  ios:
    name: iOS Workflow
    instance_type: mac_mini
    max_build_duration: 60
    environment:
      vars:
        MY_VAR: 'value'

    scripts:
      # Шаг 1: Установка зависимостей через Swift Package Manager
      - name: Resolve Swift dependencies
        script: |
          swift package resolve

      # Шаг 2: Сборка проекта через Swift Package Manager
      - name: Build project with Swift Package Manager
        script: |
          swift build

      # Шаг 3: Архивация приложения и экспорт IPA через встроенный шаг
      - xcode-archive:
          inputs:
            - export_method: "development"
            - export_options_plist: "$PWD/ExportOptions.plist"
            - output_dir: "$BITRISE_DEPLOY_DIR"

      # Шаг 4: Загрузка IPA как артефакт
      - deploy-to-bitrise-io:
          inputs:
            - deploy_path: "$BITRISE_DEPLOY_DIR"
