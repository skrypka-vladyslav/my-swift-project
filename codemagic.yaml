workflows:
  ios:
    name: Build iOS app
    max_build_duration: 60
    environment:
      xcode: latest  # Указываем, что используем Xcode для сборки
    scripts:
      - name: Build the app
        script: |
          # Сборка проекта с использованием Xcode и создания архива .ipa
          xcodebuild clean archive \
            -project "my-swift-project.xcodeproj" \  # Используем .xcodeproj вместо .xcworkspace
            -scheme "my-swift-project" \  # Указываем правильную схему
            -sdk iphoneos \
            -archivePath "$PWD/build/my-swift-project.xcarchive"
      - name: Export IPA
        script: |
          # Экспорт .ipa файла из .xcarchive без использования ExportOptions.plist
          xcodebuild -exportArchive \
            -archivePath "$PWD/build/my-swift-project.xcarchive" \
            -exportPath "$PWD/build/ios/iphoneos"
    artifacts:
      - build/ios/iphoneos/*.ipa  # Указываем путь для артефактов
